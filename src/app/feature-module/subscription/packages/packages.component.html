<div class="page-header">
    <div class="content-page-header page-tilte">
        <h5 *ngIf="!isAdmin">{{ 'subscriptions.myPlan' | translate }}</h5>
        <h5 *ngIf="isAdmin">{{ 'subscriptions.allSystemPlan' | translate }}</h5>
        <div class="page-content">
            <div class="list-btn">
                <ul class="filter-list">
                    <li *ngIf="activeSearch">
                        <div class="form-custom">
                            <input [(ngModel)]="searchString" (input)="searchData(searchString)" type="text"
                                class="form-control" id="member_search1" placeholder="Search Customer">
                        </div>
                    </li>
                    <li *ngIf="activeSearch">
                        <a class="btn-filters btn-hover" href="javascript:void(0);" matTooltip="Close Research"
                            (click)="toggleSearch()">
                            <span><i class="feather icon-x"></i></span>
                        </a>
                    </li>
                    <li *ngIf="!activeSearch">
                        <a class="btn-filters btn-hover" href="javascript:void(0);" matTooltip="Research user"
                            (click)="toggleSearch()">
                            <span><img src="assets/img/icons/search.svg" alt="img" style="color: #021d66;"></span>
                        </a>
                    </li>
                    <li *ngIf="isAdminRoute">
                        <a class="btn-filters btn-hover" data-bs-toggle="tooltip" data-bs-placement="bottom"
                            (click)="filterByPeriod('yearly')" matTooltip="Yearly plans"><span>Y</span></a>
                    </li>
                    <li *ngIf="isAdminRoute">
                        <a class="btn-filters btn-hover" data-bs-toggle="tooltip" data-bs-placement="bottom"
                            (click)="filterByPeriod('monthly')" matTooltip="Monthly plans"><span>M</span></a>
                    </li>
                    <li *ngIf="isAdminRoute">
                        <a class="btn-filters btn-hover" data-bs-toggle="tooltip" data-bs-placement="bottom"
                            (click)="filterByPeriod('dayly')" matTooltip="Dayly plans"><span>D</span></a>
                    </li>
                    <li>
                        <a class="btn-filters btn-hover" data-bs-toggle="tooltip" data-bs-placement="bottom"
                            matTooltip="List-View"><span><i class="feather icon-list"></i></span></a>
                    </li>
                    <li>
                        <a class="btn-filters btn-hover" href="javascript:void(0);" data-bs-toggle="tooltip"
                            data-bs-placement="bottom" matTooltip="Refresh" (click)="refresh()"><span><i
                                    class="feather icon-refresh-ccw"></i></span></a>
                    </li>

                    <!-- <li>
                        <div class="dropdown dropdown-action" data-bs-toggle="tooltip" data-bs-placement="bottom"
                            title="Download" matTooltip="Download">
                            <a href="javascript:void(0);" class="btn btn-filters btn-hover" data-bs-toggle="dropdown"
                                aria-expanded="false"><span class="me-2"><i
                                        class="feather icon-download btn-hover"></i></span>Export</a>
                            <div class="dropdown-menu dropdown-menu-end">
                                <ul class="d-block">
                                    <li>
                                        <a class="d-flex align-items-center download-item" href="javascript:void(0);"
                                            download><i class="far fa-file-pdf me-2"></i>Export as PDF</a>
                                    </li>
                                    <li>
                                        <a class="d-flex align-items-center download-item" href="javascript:void(0);"
                                            download><i class="far fa-file-text me-2"></i>Export as Excel</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li> -->
                    <li *ngIf="currentUser">
                        <a class="btn btn-primary" href="javascript:void(0);" data-bs-toggle="modal"
                            data-bs-target="#add_newpackage"><i class="fa fa-plus-circle me-2" aria-hidden="true"></i>{{
                            'subscriptions.add' | translate }}</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- /Page Header -->

<div class="super-admin-list-head">
    <div class="row">
        <div class="col-xl-3 col-md-6 d-flex">
            <div class="card w-100">
                <div class="card-body card-head">
                    <div class="grid-info-item total-plane">
                        <div class="grid-info">
                            <span>{{ 'subscriptions.totalPlans' | translate }}</span>
                            <h4 *ngIf="gettingStatistics">{{ "loading" | translate }}...</h4>
                            <h4 *ngIf="!gettingStatistics">{{ statistics.totalPlans }}</h4>
                        </div>
                        <div class="grid-head-icon">
                            <i class="feather icon-package"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 d-flex">
            <div class="card w-100">
                <div class="card-body card-head">
                    <div class="grid-info-item active-plane">
                        <div class="grid-info">
                            <span>{{ 'subscriptions.activePlans' | translate }}</span>
                            <h4 *ngIf="gettingStatistics">{{ "loading" | translate }}...</h4>
                            <h4 *ngIf="!gettingStatistics">{{ statistics.activePlans }}</h4>
                        </div>
                        <div class="grid-head-icon">
                            <i class="feather icon-list"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 d-flex">
            <div class="card w-100">
                <div class="card-body card-head">
                    <div class="grid-info-item inactive-plane">
                        <div class="grid-info">
                            <span>{{ 'subscriptions.inactivePlan' | translate }}</span>
                            <h4 *ngIf="gettingStatistics">{{ "loading" | translate }}...</h4>
                            <h4 *ngIf="!gettingStatistics">{{ statistics.inactivePlans }}</h4>
                        </div>
                        <div class="grid-head-icon">
                            <i class="feather icon-pause-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 d-flex">
            <div class="card w-100">
                <div class="card-body card-head">
                    <div class="grid-info-item total-type">
                        <div class="grid-info">
                            <span>{{ 'subscriptions.totalSubscribers' | translate }}</span>
                            <h4>00</h4>
                        </div>
                        <div class="grid-head-icon">
                            <i class="feather icon-pocket"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row d-flex align-items-center justify-content-center" *ngIf="!watingPlansList && plansList?.length >= 1">
    <div class="col-sm-12 col-md-6 col-lg-6 col-xl-3" *ngFor="let plan of plansList">
        <div class="packages card">
            <app-item [plan]="plan" [currentUser]="currentUser"></app-item>
            <div class="d-flex justify-content-center package-edit">
                <button type="button" (click)="selectPlan(plan)" type="button" class="btn btn-secondary mt-1 me-1"
                    data-bs-toggle="modal" data-bs-target="#package_details">
                    <i class="feather icon-menu"></i>
                </button>
                <button type="button" *ngIf="isAuthor(plan) || isAdmin" (click)="selectPlan(plan)"
                    class="btn btn-rounded btn-outline-primary me-1" href="javascript:void(0);" data-bs-toggle="modal"
                    data-bs-target="#edit_package">
                    <i class="feather icon-edit"></i>
                </button>
                <button type="button" *ngIf="isAuthor(plan) || isAdmin" (click)="toggleActivation(plan._id)"
                    class="btn btn-rounded btn-outline-primary me-1" href="javascript:void(0);">
                    <i class="feather icon-power"></i>
                </button>
                <button type="button" *ngIf="isAuthor(plan) || isAdmin" (click)="selectPlan(plan)"
                    class="btn btn-rounded btn-outline-danger me-1" href="javascript:void(0);" data-bs-toggle="modal"
                    data-bs-target="#delete_modal">
                    <i class="feather icon-trash-2"></i>
                </button>
            </div>
            <div class="d-flex justify-content-center" *ngIf="!isAuthor(plan) && plan.isActive">
                <button class="btn btn-rounded btn-primary me-1" style="margin-top: 20px;" (click)="checkSbscriberStatus(plan)"
                    data-bs-toggle="modal" data-bs-target="#subscriptionModal">{{
                    'subscriptions.subscribe' | translate }}</button>
            </div>
        </div>
    </div>
</div>

<!-- Nothing to show -->
<div class="row d-flex align-items-center justify-content-center" *ngIf="!watingPlansList && plansList?.length < 1">
    <div style="display: flex;
        justify-content: center;
        align-items: center;
        height: 300px;">
        <img src="../../../../assets/img/ressorces/nts.png" alt="" style="max-width: 150px;
        height: auto;">
        <br>
        {{ "nts" | translate }}
        <br><br>
        <a class="btn btn-primary m-2" href="javascript:void(0);" data-bs-toggle="modal"
            data-bs-target="#add_newpackage"><i class="fa fa-plus-circle me-2" aria-hidden="true"></i>{{
            'subscriptions.add' | translate }}</a>
    </div>
</div>

<div class="row">
    <div class="col-xl-6">
        <div class="card">
            <div class="card-body">
                <h4 class="header-title">Static backdrop</h4>

                <p>
                    When backdrop is set to static, the modal will not close when clicking
                    outside it. Click the button below to try it.
                </p>

                <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#subscriptionModal">
                    Launch static backdrop modal
                </button>

                <!-- Modal -->
            </div>
        </div>
    </div>
</div>

<div class="row d-flex align-items-center justify-content-center" *ngIf="watingPlansList">
    <div style="display: flex;
        justify-content: center;
        align-items: center;
        height: 300px;">
        <div class="spinner-border" role="status"></div>
    </div>
</div>


<!-- Add New Package Modal -->
<div class="modal custom-modal fade p-20" id="add_newpackage" role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header border-0">
                <div class="form-header modal-header-title text-start mb-0">
                    <h4 class="mb-0">{{ 'subscriptions.add' | translate }}</h4>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="img-upload">
                                <div class="profile-img company-profile-img">
                                    <img id="company-img" class="img-fluid me-0" src="assets/img/icons/price-01.svg"
                                        (click)="selectImg('assets/img/icons/price-01.svg')" alt="profile-img">
                                </div>
                                <div class="profile-img company-profile-img">
                                    <img id="company-img" class="img-fluid me-0" src="assets/img/icons/price-02.svg"
                                        (click)="selectImg('assets/img/icons/price-02.svg')" alt="profile-img">
                                </div>
                                <div class="profile-img company-profile-img">
                                    <img id="company-img" class="img-fluid me-0" src="assets/img/icons/price-03.svg"
                                        (click)="selectImg('assets/img/icons/price-03.svg')" alt="profile-img">
                                </div>
                                <div class="profile-img company-profile-img">
                                    <img id="company-img" class="img-fluid me-0" src="assets/img/icons/price-04.svg"
                                        (click)="selectImg('assets/img/icons/price-04.svg')" alt="profile-img">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="profile-picture">
                                <div class="upload-profile">
                                    <div class="profile-img company-profile-img">
                                        <img id="company-img" class="img-fluid me-0" [src]="imageUrl" alt="profile-img">
                                    </div>
                                    <div class="add-profile">
                                        <h5>{{title}}</h5>
                                        <span>{{subTitle}}</span>
                                    </div>
                                </div>
                                <div class="img-upload">
                                    <!-- <label class="btn btn-upload">
                                        Upload <input type="file">
                                    </label>
                                    <a class="btn btn-remove">Remove</a> -->
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <h5 class="form-title mb-3">{{ "subscriptions.planInfo" | translate }}</h5>
                        </div>
                        <div class="col-sm-12 col-md-6">
                            <div class="input-block mb-3">
                                <label>{{ "subscriptions.name" | translate }}</label>
                                <input type="text" class="form-control" placeholder="" formControlName="title"
                                    (input)="updateTitle()">
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-6">
                            <div class="input-block mb-3">
                                <label>{{ "subscriptions.subTitle" | translate }}</label>
                                <input type="text" class="form-control" placeholder="" formControlName="subTitle"
                                    (input)="updateTitle()">
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-6">
                            <div class="input-block mb-3">
                                <label>Type</label>
                                <mat-select class="select custom-mat-select" placeholder="Monthly"
                                    formControlName="cycle">
                                    <mat-option value="yearly">{{ "subscriptions.yearly" | translate }}</mat-option>
                                    <mat-option value="monthly">{{ "subscriptions.monthly" | translate }}</mat-option>
                                    <mat-option value="weekly">{{ "subscriptions.weekly" | translate }}</mat-option>
                                    <mat-option value="dayly">{{ "subscriptions.dayly" | translate }}</mat-option>
                                </mat-select>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-6">
                            <div class="input-block mb-3">
                                <label class="d-flex justify-content-between">
                                    <span>{{ "subscriptions.price" | translate }}</span>
                                    <span class="text-primary"><i class="fa-solid fa-circle-exclamation me-2"></i>
                                        {{ "subscriptions.zeroIfFree" | translate }}</span>
                                </label>
                                <div class="input-group">
                                    <input class="form-control" style="text-align: right" type="text" id="price"
                                        placeholder="" formControlName="price" (input)="formatAmount($event)" />
                                    <span class="input-group-text">{{ currentUser?.countryId.currency }}</span>
                                </div>
                            </div>
                        </div>
                        <h6>{{ "subscriptions.optionTitle" | translate }}</h6>
                        <div class="col-sm-12 col-md-12" formArrayName="options">
                            <div class="option-space" *ngFor="let option of optionsList.controls; let i = index"
                                [formGroupName]="i">
                                <div class="row">
                                    <div class="col-sm-12 col-md-6">
                                        <div class="input-block mb-3">
                                            <input type="text" class="form-control" placeholder=""
                                                formControlName="title" [id]="'title' + i">
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-4">
                                        <div class="d-flex align-items-center mb-3">
                                            <h6 class="mb-0">{{ "subscriptions.checkIfAvailable" | translate }}</h6>
                                            <div class="status-toggle">
                                                <input [id]="'isActive' + i" formControlName="isActive" class="check"
                                                    type="checkbox">
                                                <label [for]="'isActive' + i" class="checktoggle checkbox-bg">{{
                                                    "subscriptions.status" | translate }}</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-2">
                                        <button type="button" class="btn btn-block btn-outline-light active"
                                            [disabled]="i < 1" (click)="removeTicketClass(i)">
                                            <i class="fa fa-trash me-2" aria-hidden="true" style="color: #d00101;"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-3">
                            <div class="input-block mb-3">
                                <label></label>
                                <a class="btn btn-primary" href="javascript:void(0);" (click)="addOptions()"><i
                                        class="fa fa-plus me-2" aria-hidden="true"></i> {{ "subscriptions.addOption" |
                                    translate }}</a>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12">
                            <div class="input-block mb-3">
                                <label>{{ "subscriptions.description" | translate }}</label>
                                <textarea type="text" class="form-control" placeholder="Enter Description"
                                    formControlName="description"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" data-bs-dismiss="modal" class="btn btn-back cancel-btn me-2"
                        *ngIf="!watingCreation">{{ "action.cancel" | translate }}</button>
                    <button type="submit" class="btn btn-primary paid-continue-btn" [disabled]="watingCreation"
                        *ngIf="!watingCreation">
                        {{ "subscriptions.create" | translate }}</button>
                    <button class="btn btn-primary paid-continue-btn" [disabled]="watingCreation"
                        *ngIf="watingCreation">
                        <div class="spinner-border" role="status"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- /Add New Package Modal -->

<!-- Delete Items Modal -->
<div class="modal custom-modal fade modal-delete" id="delete_modal" role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content">
            <div class="modal-body">
                <div class="form-header">
                    <div class="">
                        <span><i class="feather icon-trash" style="color: red; width: 100px !important;"></i></span>
                    </div>
                    <h3>{{ "subscriptions.deletePlan" | translate }} ?</h3>
                    <p>{{ "subscriptions.wantDeletePlan" | translate }} <b>{{selectedPlan?.title}}</b></p>
                </div>
                <div class="modal-btn delete-action">
                    <div class="modal-footer justify-content-center p-0">
                        <button type="submit" (click)="deletePlan(selectedPlan._id)" class="btn btn-danger m-1">{{
                            "action.delete" | translate }}</button>
                        <button type="button" data-bs-dismiss="modal" class="btn btn-primary m-1">{{ "action.cancel"
                            | translate }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Delete Items Modal -->


<!-- Package details modal content -->
<div class="modal custom-modal fade modal-delete" id="package_details" role="dialog">
    <div class="modal-dialog modal-sm modal-right">
        <div class="modal-content">
            <!-- <div class="modal-header border-0">
                <h4 class="mt-0">{{ selectedPlan?.title }}</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div> -->
            <div class="modal-body">
                <div class="text-left" *ngIf="selectedPlan">
                    <app-item [plan]="selectedPlan" [currentUser]="currentUser"></app-item>
                    <br>
                    <ul>
                        <li *ngFor="let option of optionsData" style="margin-bottom: 5px;">
                            <span *ngIf="option.isActive"><i class="fa-solid fa-circle-check"></i> {{ option.title
                                }}</span>
                            <span *ngIf="!option.isActive"><i class="feather icon-x-circle"></i><s> {{ option.title
                                    }}</s></span>
                        </li>
                    </ul>
                    <p>
                        {{ selectedPlan?.description}}
                    </p>
                    <div style="text-align: center"> {{ "subscriptions.author" | translate }}: {{
                        showName(selectedPlan?.author) }}</div><br>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-dismiss="modal">
                        {{ "action.close" | translate }}
                    </button>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
</div>


<div class="modal fade" id="subscriptionModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">
                    {{ selectedPlan?.title }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div *ngIf="checkingSubscriptionStatus">
                    <div style="display: flex;
                        justify-content: center;
                        align-items: center;
                        height: 300px;">
                        <div class="spinner-border" role="status"></div>
                    </div>
                </div>
                <div *ngIf="!checkingSubscriptionStatus && isSubscriber">
                    You are already subscriber.
                </div>
                <div *ngIf="!checkingSubscriptionStatus && !isSubscriber">
                    Anim pariatur cliche reprehenderit, enim eiusmod high life
                    accusamus terry richardson ad squid. 3 wolf moon officia aute,
                    non cupidatat skateboard dolor brunch. Food truck quinoa
                    nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua
                    put a bird on it squid single-origin coffee nulla assumenda
                    shoreditch et.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Close
                </button>
                <button type="button" class="btn btn-primary">
                    Understood
                </button>
            </div>
        </div>
    </div>
</div>