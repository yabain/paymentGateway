<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Retrait d'argent — Assistant 3 étapes</title>
<style>
  /* ===== Thème clair minimal ===== */
  :root{
    --bg: #fafbfe;
    --paper: #ffffff;
    --ink: #0f172a;
    --muted:#637086;
    --line:#e7e9f0;
    --brand:#0ea5e9;      /* azure */
    --brand-2:#10b981;    /* green */
    --danger:#ef4444;
    --ok:#16a34a;
    --radius:14px;
    --shadow:0 10px 30px rgba(15,23,42,.06);
    --focus:0 0 0 3px rgba(14,165,233,.25);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    color:var(--ink); background:
      radial-gradient(900px 500px at 10% -10%, #e0f2fe 0%, transparent 60%),
      radial-gradient(800px 500px at 100% 0%, #dcfce7 0%, transparent 60%),
      var(--bg);
  }
  a{color:inherit}
  .shell{max-width:1100px; margin:0 auto; padding:20px 18px 28px}
  header{
    display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px;
  }
  .brand{display:flex; align-items:center; gap:10px; text-decoration:none}
  .logo{
    width:40px; height:40px; border-radius:10px; display:grid; place-items:center;
    background:linear-gradient(135deg, #7dd3fc, #86efac); box-shadow:var(--shadow);
  }
  .brand b{letter-spacing:.2px}
  .support{
    font-size:.9rem; color:var(--muted)
  }

  /* ===== Mise en page maître ===== */
  .layout{
    display:grid; gap:16px; grid-template-columns: 1fr;
  }
  @media (min-width: 940px){
    .layout{ grid-template-columns: 1.2fr .8fr; }
  }

  .card{
    background:var(--paper); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
  }

  /* ===== Stepper ===== */
  .stepper{
    display:flex; gap:12px; padding:14px; border-bottom:1px solid var(--line);
    position:sticky; top:0; background:#fff; border-radius:14px 14px 0 0; z-index:1;
  }
  .step{
    display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:999px; border:1px dashed #dbe1ea; background:#f8fbff;
    color:var(--muted); font-weight:700; white-space:nowrap;
  }
  .step.current{ border-style:solid; color:#0b1220; background:#eefaff; }
  .step .dot{
    width:26px; height:26px; border-radius:999px; display:grid; place-items:center; font-size:.9rem;
    background:#fff; border:1px solid var(--line);
  }
  .step.current .dot{ border-color:#93c5fd; box-shadow:0 0 0 2px rgba(14,165,233,.18) }

  .pane{ padding:18px; }

  /* ===== Form & champs ===== */
  .grid{display:grid; gap:12px}
  .two{ grid-template-columns:1fr }
  @media (min-width:720px){ .two{ grid-template-columns:1fr 1fr } }

  .field{display:grid; gap:6px}
  .field label{font-weight:700}
  .input, select{
    padding:12px 12px; border-radius:12px; border:1px solid var(--line); background:#fff; color:var(--ink); outline:none;
  }
  .input:focus, select:focus{ box-shadow:var(--focus); border-color:#bae6fd }
  .help{color:var(--muted); font-size:.9rem}
  .inline{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

  .btn{
    appearance:none; border:none; cursor:pointer; font-weight:800;
    padding:12px 16px; border-radius:12px; transition:.15s; outline:none; color:#fff;
    background:linear-gradient(135deg, var(--brand), var(--brand-2));
    box-shadow:0 12px 28px rgba(14,165,233,.22);
  }
  .btn.secondary{ background:#fff; color:var(--ink); border:1px solid var(--line); box-shadow:none }
  .btn.ghost{ background:transparent; color:var(--ink); border:1px dashed #cfd6e2 }

  .bar{
    display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; padding:14px 18px; border-top:1px solid var(--line);
    background:#fbfeff; border-radius:0 0 14px 14px;
  }

  /* ===== Récap latéral ===== */
  .summary{
    position:sticky; top:16px; padding:18px;
  }
  .amount{
    font-size: clamp(28px, 4.5vw, 36px); font-weight:900;
  }
  .chip{ padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#f6f9ff; color:var(--muted); font-weight:700; }
  .row{
    display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 0; border-bottom:1px dashed #e6eaf2;
  }
  .row:last-child{ border-bottom:0 }
  .fee{ font-weight:800 }
  .okay{ color:var(--ok) }
  .warn{ color:#b45309 }
  .err{ color:var(--danger) }

  /* ===== Toast ===== */
  .toast{
    position:fixed; right:16px; bottom:16px; background:#ecfdf5; color:#065f46; border:1px solid #bbf7d0;
    padding:12px 14px; border-radius:12px; display:none; box-shadow:var(--shadow);
  }
  .toast.show{display:block; animation:fade 3s ease forwards}
  @keyframes fade{0%{opacity:0; transform:translateY(8px)}10%{opacity:1; transform:none}80%{opacity:1}100%{opacity:0}}

  .hidden{display:none !important}
</style>
</head>
<body>
  <div class="shell">
    <header>
      <a class="brand" href="#">
        <span class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="#0f172a" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 7a3 3 0 0 1 3-3h9a1 1 0 1 1 0 2H7a1 1 0 0 0 0 2h12a3 3 0 0 1 3 3v5a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7Z"/>
            <rect x="15" y="10" width="6" height="6" rx="2"/>
          </svg>
        </span>
        <b>Portefeuille</b>
      </a>
      <div class="support">Solde en XAF • <span id="miniBalance">—</span></div>
    </header>

    <div class="layout">
      <!-- ========= Colonne principale : Assistant 3 étapes ========= -->
      <section class="card">
        <nav class="stepper" aria-label="Étapes de retrait">
          <div class="step current" data-step="1"><span class="dot">1</span> Choix</div>
          <div class="step" data-step="2"><span class="dot">2</span> Coordonnées</div>
          <div class="step" data-step="3"><span class="dot">3</span> Vérification</div>
        </nav>

        <!-- Étape 1 : Choix -->
        <div class="pane" id="step-1">
          <div class="grid">
            <div class="field">
              <label for="amount">Montant à retirer</label>
              <input id="amount" class="input" type="number" inputmode="numeric" min="1000" step="100" placeholder="Ex. 25 000" />
              <div class="help">Minimum 1 000 F — solde disponible : <b id="balanceHelp">—</b></div>
            </div>

            <div class="field">
              <label for="method">Moyen de retrait</label>
              <select id="method" class="input" aria-label="Sélectionner le moyen de retrait">
                <option value="om" selected>Orange Money — 1,2% + 100 F</option>
                <option value="mtn">MTN Mobile Money — 1% + 150 F</option>
                <option value="bank">Virement bancaire — 0,8% + 300 F</option>
              </select>
              <div class="help">Vous pourrez saisir les informations à l’étape suivante.</div>
            </div>
          </div>
        </div>

        <!-- Étape 2 : Coordonnées dynamiques -->
        <div class="pane hidden" id="step-2">
          <!-- Orange Money -->
          <div id="block-om" class="grid two">
            <div class="field">
              <label for="omName">Titulaire (OM)</label>
              <input id="omName" class="input" type="text" placeholder="Noms et prénoms" autocomplete="name"/>
            </div>
            <div class="field">
              <label for="omPhone">N° Orange Money</label>
              <input id="omPhone" class="input" type="tel" placeholder="+237 6 XX XX XX XX" pattern="^(\+?237)?\s*6\d{8}$" autocomplete="tel"/>
              <div class="help">Format : +237 6XXXXXXXX</div>
            </div>
          </div>

          <!-- MTN -->
          <div id="block-mtn" class="grid two hidden">
            <div class="field">
              <label for="mtnName">Titulaire (MTN)</label>
              <input id="mtnName" class="input" type="text" placeholder="Noms et prénoms" autocomplete="name"/>
            </div>
            <div class="field">
              <label for="mtnPhone">N° MTN Mobile Money</label>
              <input id="mtnPhone" class="input" type="tel" placeholder="+237 6 XX XX XX XX" pattern="^(\+?237)?\s*6\d{8}$" autocomplete="tel"/>
              <div class="help">Format : +237 6XXXXXXXX</div>
            </div>
          </div>

          <!-- Banque -->
          <div id="block-bank" class="grid two hidden">
            <div class="field">
              <label for="bankHolder">Titulaire du compte</label>
              <input id="bankHolder" class="input" type="text" placeholder="Noms et prénoms" autocomplete="name"/>
            </div>
            <div class="field">
              <label for="bankName">Banque</label>
              <input id="bankName" class="input" type="text" placeholder="Ex. Afriland First Bank"/>
            </div>
            <div class="field">
              <label for="bankAccount">N° de compte / IBAN</label>
              <input id="bankAccount" class="input" type="text" placeholder="Ex. 1234567890"/>
            </div>
            <div class="field">
              <label for="bankSwift">SWIFT (optionnel)</label>
              <input id="bankSwift" class="input" type="text" placeholder="Ex. ABCDCCMM"/>
            </div>
          </div>

          <div class="inline" style="margin-top:6px">
            <input id="terms" type="checkbox"/>
            <label for="terms">Je confirme l’exactitude des informations.</label>
          </div>
        </div>

        <!-- Étape 3 : Vérification -->
        <div class="pane hidden" id="step-3">
          <div id="review" class="grid">
            <!-- Injecté par JS -->
          </div>
        </div>

        <!-- Barre d’actions -->
        <div class="bar">
          <button class="btn ghost" id="prev" disabled>Retour</button>
          <div class="inline">
            <button class="btn secondary" id="reset">Réinitialiser</button>
            <button class="btn" id="next">Suivant</button>
            <button class="btn hidden" id="confirm">Confirmer</button>
          </div>
        </div>
      </section>

      <!-- ========= Colonne de résumé ========= -->
      <aside class="card summary" aria-live="polite">
        <div class="inline" style="justify-content:space-between; margin-bottom:8px">
          <b>Résumé</b>
          <span class="chip" id="lastSync">—</span>
        </div>
        <div class="amount" id="sumBalance">—</div>
        <div class="help" style="margin-bottom:10px">Solde disponible</div>
        <div class="row"><span>Montant</span><b id="sumAmount">—</b></div>
        <div class="row"><span>Frais estimés</span><b id="sumFees">—</b></div>
        <div class="row"><span>Net reçu</span><b class="okay" id="sumNet">—</b></div>
        <div class="row"><span>Méthode</span><b id="sumMethod">—</b></div>
        <div class="help" id="hint" style="margin-top:6px"></div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast">✅ Retrait initié. Réf : <b id="txref"></b></div>

<script>
  // ====== État simulé ======
  let balance = 318500; // XAF
  const fmt = new Intl.NumberFormat('fr-CM', { style:'currency', currency:'XAF', maximumFractionDigits:0 });
  const $ = id => document.getElementById(id);
  const show = el => el.classList.remove('hidden');
  const hide = el => el.classList.add('hidden');

  const fees = {
    om:  { rate: 0.012, fixed: 100, label:'Orange Money' },
    mtn: { rate: 0.010, fixed: 150, label:'MTN Mobile Money' },
    bank:{ rate: 0.008, fixed: 300, label:'Virement bancaire' }
  };

  // ====== UI init ======
  function syncHeader(){
    $('miniBalance').textContent = fmt.format(balance);
    $('sumBalance').textContent = fmt.format(balance);
    $('balanceHelp').textContent = fmt.format(balance);
    $('lastSync').textContent = 'Maj ' + new Date().toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
  }
  syncHeader();

  // ====== Calcul frais ======
  function calc(amount, method){
    const cfg = fees[method];
    const f = Math.max(0, Math.round(amount * cfg.rate + cfg.fixed));
    return { fee: f, net: Math.max(0, amount - f) };
  }

  function updateSummary(){
    const amount = parseInt($('amount').value||'0',10);
    const method = $('method').value;
    if(amount>0){
      const {fee, net} = calc(amount, method);
      $('sumAmount').textContent = fmt.format(amount);
      $('sumFees').textContent = fmt.format(fee);
      $('sumNet').textContent = fmt.format(net);
      $('sumMethod').textContent = fees[method].label;
      $('hint').innerHTML = amount>balance
        ? '<span class="warn">⚠️ Montant supérieur au solde.</span>'
        : 'Tout est prêt pour continuer.';
    }else{
      $('sumAmount').textContent = '—';
      $('sumFees').textContent = '—';
      $('sumNet').textContent = '—';
      $('sumMethod').textContent = '—';
      $('hint').textContent = '';
    }
  }

  // ====== Navigation étapes ======
  let step = 1;
  function setStep(n){
    step = n;
    // stepper visuel
    document.querySelectorAll('.step').forEach((s,i)=>{
      s.classList.toggle('current', i===n-1);
    });
    // panes
    ['step-1','step-2','step-3'].forEach((id,i)=>{
      (i===n-1? show: hide)($(id));
    });
    // boutons
    $('prev').disabled = (n===1);
    $('next').classList.toggle('hidden', n===3);
    $('confirm').classList.toggle('hidden', n!==3);
  }

  function validateCurrent(){
    const amount = parseInt($('amount').value||'0',10);
    const method = $('method').value;

    // Étape 1 : montant + choix
    if(step===1){
      if(!(amount>=1000)){ alert('Montant minimum : 1 000 F.'); return false; }
      if(!['om','mtn','bank'].includes(method)){ alert('Choisissez un moyen de retrait.'); return false; }
      return true;
    }
    // Étape 2 : coordonnées
    if(step===2){
      if(!$('terms').checked){ alert("Veuillez confirmer l'exactitude des informations."); return false; }
      if(method==='om'){
        const name = $('omName').value.trim(), phone=$('omPhone').value.replace(/\s+/g,'').replace(/^00/,'+');
        if(name.length<2) return alert('Nom Orange Money invalide.'), false;
        if(!/^(\+?237)?6\d{8}$/.test(phone)) return alert('Numéro Orange Money invalide.'), false;
        return true;
      }
      if(method==='mtn'){
        const name = $('mtnName').value.trim(), phone=$('mtnPhone').value.replace(/\s+/g,'').replace(/^00/,'+');
        if(name.length<2) return alert('Nom MTN Money invalide.'), false;
        if(!/^(\+?237)?6\d{8}$/.test(phone)) return alert('Numéro MTN Money invalide.'), false;
        return true;
      }
      if(method==='bank'){
        const h=$('bankHolder').value.trim(), b=$('bankName').value.trim(), a=$('bankAccount').value.trim();
        if(h.length<2) return alert('Titulaire (banque) invalide.'), false;
        if(b.length<2) return alert('Nom de banque invalide.'), false;
        if(a.length<6) return alert('N° de compte/IBAN invalide.'), false;
        return true;
      }
    }
    return true;
  }

  $('next').addEventListener('click', ()=>{
    if(!validateCurrent()) return;
    if(step===1){
      // Préparer bloc coordonnées selon méthode
      const m = $('method').value;
      ['block-om','block-mtn','block-bank'].forEach(id=>hide($(id)));
      show($('block-'+m));
      setStep(2);
    } else if(step===2){
      // Générer revue
      const amount = parseInt($('amount').value,10);
      const m = $('method').value;
      const {fee, net} = calc(amount, m);
      const rows = [];
      rows.push(['Montant', fmt.format(amount)]);
      rows.push(['Frais estimés', fmt.format(fee)]);
      rows.push(['Net reçu', fmt.format(net)]);
      rows.push(['Méthode', fees[m].label]);

      if(m==='om'){
        rows.push(['Titulaire (OM)', $('omName').value.trim()]);
        rows.push(['N° Orange Money', $('omPhone').value.trim()]);
      }
      if(m==='mtn'){
        rows.push(['Titulaire (MTN)', $('mtnName').value.trim()]);
        rows.push(['N° MTN Mobile Money', $('mtnPhone').value.trim()]);
      }
      if(m==='bank'){
        rows.push(['Titulaire', $('bankHolder').value.trim()]);
        rows.push(['Banque', $('bankName').value.trim()]);
        rows.push(['Compte / IBAN', $('bankAccount').value.trim()]);
        const s = $('bankSwift').value.trim(); if(s) rows.push(['SWIFT', s]);
      }

      const review = $('review'); review.innerHTML='';
      rows.forEach(([k,v])=>{
        const div = document.createElement('div');
        div.className = 'row';
        div.innerHTML = `<span>${k}</span><b>${v||'—'}</b>`;
        review.appendChild(div);
      });
      setStep(3);
    }
  });

  $('prev').addEventListener('click', ()=>{
    setStep(Math.max(1, step-1));
  });

  $('reset').addEventListener('click', ()=>{
    // reset form
    $('amount').value='';
    $('method').value='om';
    ['omName','omPhone','mtnName','mtnPhone','bankHolder','bankName','bankAccount','bankSwift'].forEach(id=>{ const el=$(id); if(el) el.value=''; });
    $('terms').checked=false;
    setStep(1);
    updateSummary();
    syncHeader();
  });

  // Confirm (simulation)
  function randomRef(){ return 'TX-' + Math.random().toString(36).slice(2,8).toUpperCase(); }
  $('confirm').addEventListener('click', ()=>{
    const amount = parseInt($('amount').value||'0',10);
    balance = Math.max(0, balance - amount);
    syncHeader();
    const t = $('toast'); $('txref').textContent = randomRef(); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3100);
    $('reset').click();
  });

  // Live updates
  ['amount','method','omName','omPhone','mtnName','mtnPhone','bankHolder','bankName','bankAccount','bankSwift','terms'].forEach(id=>{
    const el=$(id); if(el){
      el.addEventListener('input', updateSummary);
      el.addEventListener('change', updateSummary);
    }
  });
  updateSummary();
  setStep(1);
</script>
</body>
</html>
