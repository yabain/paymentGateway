"use strict";(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[2076],{83419:(D,v,n)=>{n.d(v,{M:()=>p});var t=n(96697),f=n(48455),h=n(96354),g=n(71985),a=n(54438),M=n(78931),m=n(20543),_=n(54441),C=n(19975),c=n(45794);let p=(()=>{class s{constructor(e,r,o,i,l){this.firestore=e,this.storage=r,this.authService=o,this.paymentService=i,this.toastService=l}getInvoiceData(e){return this.firestore.read(`invoices/${e}`)}getTransactionsList(e){return this.firestore.read(`transactions/${e}`)}getAllInvoiceData(){return this.firestore.getDocuments("invoices").pipe((0,t.s)(1))}creatInvoice(e){return e.id=this.generateId(),(0,f.H)(this.firestore.create(`invoices/${e.id}`,e)).pipe((0,h.T)(()=>({success:!0,message:"Votre facture a bien \xe9t\xe9 cr\xe9\xe9"})))}updateInvoice(e){return(0,f.H)(this.firestore.update(`invoices/${e.id}`,e)).pipe((0,h.T)(()=>({success:!0,message:"Votre facture a bien \xe9t\xe9 cr\xe9\xe9"})))}generateId(e){const r=new Date,o=r.getFullYear().toString().slice(-2),i=this.padNumber(r.getMonth()+1,2),l=this.padNumber(r.getDate(),2),d=this.padNumber(r.getHours(),2),E=this.padNumber(r.getMinutes(),2),P=this.padNumber(r.getSeconds(),2),b=Math.floor(900*Math.random())+100;let O="";return O="TR"===e?`TR${b}#${o}${i}${l}${d}${E}${P}`:`IN${b}#${o}${i}${l}${d}${E}${P}`,O}padNumber(e,r){let o=e.toString();for(;o.length<r;)o="0"+o;return o}checkTransactionStatus(e){return new g.c(r=>{let o=e.ref.token;console.log("Token:",o),this.paymentService.getPaymentStatus(o).subscribe({next:i=>{i?r.next(i):(console.error("Invalid response"),r.error("Invalid response"))},error:i=>{console.error("Error:",i),r.error(i)},complete:()=>{r.complete()}})})}handleSuccessfulRequest(e,r){return r&&r.data?(console.log("Donn\xe9es de r\xe9ponse Ici ici:",r),e.ref||(e.ref={ref:r.data.ref,token:r.data.token}),"financial_transaction_pending"===r.data.state?(e.status="Pending",console.log("Donn\xe9es finales de transaction \xe0 sauvegarder: ",e),this.firestore.addObjectToField(`transactions/${e.invoiceId}`,e.id,e).then(()=>(console.log("Le formulaire a bien \xe9t\xe9 enregistr\xe9:",e),Promise.resolve({status:"Pending",data:e}))).catch(o=>(console.error("Erreur lors de la sauvegarde des donn\xe9es:",o),this.toastService.error("Erreur lors de la sauvegarde des donn\xe9es","Erreur"),Promise.reject({status:"Error",data:e})))):"financial_transaction_success"===r.data.state?(e.status="Completed",console.log("Donn\xe9es finales de transaction Completed \xe0 sauvegarder: ",e),this.firestore.addObjectToField(`transactions/${e.invoiceId}`,e.id,e).then(()=>Promise.resolve({status:"Completed",data:e})).catch(o=>(console.error("Erreur lors de la sauvegarde des donn\xe9es Success:",o),this.toastService.error("Erreur lors de la sauvegarde des donn\xe9es","Erreur"),Promise.reject({status:"Error",data:e})))):"financial_transaction_error"===r.data.state?(console.log("Erreur financi\xe8re d\xe9tect\xe9e"),this.handleTransactionStateError(e,r),Promise.resolve({status:"Error",data:e})):(console.log("Erreur inconnue d\xe9tect\xe9e"),this.handleTransactionStateError(e,r),this.toastService.error("Une erreur inconnue s'est produite","Erreur"),Promise.reject({status:"Error",data:e}))):(console.error("Donn\xe9es de r\xe9ponse invalides:",r),this.toastService.error("Donn\xe9es de r\xe9ponse invalides","Erreur"),Promise.reject("Donn\xe9es de r\xe9ponse invalides"))}handleTransactionStateError(e,r){return e.status="Rejected",e.ref={ref:r.data.ref,token:r.data.token},e.statusMsg={"-201":"Compte Orage Money introuvable","-202":"Receiver account not found","-200":"Erreur inconnue","-204":"Le solde du compte OM payeur insufisant, veuillez recharger votre compte OM","-205":"M\xe9thode de paiment invalide","-206":"Montant invalide","-207":"Longue attente serveur","-208":"La transaction a \xe9t\xe9 rejet\xe9 par le payeur"}[r.data.error]||"Erreur inconnue",this.toastService.error(e.statusMsg,"Erreur",{timeOut:1e4}),this.firestore.addObjectToField(`transactions/${e.invoiceId}`,e.id,e).then(()=>(console.log("Le formulaire a bien \xe9t\xe9 sauvegard\xe9: ",e),{status:!0,data:e})).catch(i=>(console.error("Erreur lors de la sauvegarde des donn\xe9es:",i),{status:!1,data:e}))}static{this.\u0275fac=function(r){return new(r||s)(a.KVO(M.B),a.KVO(m.n),a.KVO(_.u),a.KVO(C.W),a.KVO(c.tw))}}static{this.\u0275prov=a.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})()},19975:(D,v,n)=>{n.d(v,{W:()=>p});var t=n(88141),f=n(99437),h=n(96697),g=n(45312),a=n(71985),M=n(18810),m=n(54438),_=n(21626),C=n(78931),c=n(45794);let p=(()=>{class s{constructor(e,r,o){this.http=e,this.firestore=r,this.toastService=o}deposit(e,r){const o=g.c.apiUrl+"/payment/pay",i={amount:e.payment,type:"deposit",paymentMode:"ORANGE",moneyCode:"XAF",userRef:{fullName:e.name,account:`${e.phone}`},raison:"Paiement de facture",appID:r};return console.log("depositData",i),console.log("endpoint: ",o),new a.c(l=>{this.http.post(o,i).subscribe(d=>{l.next(d),l.complete()},d=>{l.error(d),l.complete()})})}getPaymentStatus(e,r){return this.http.get(g.c.apiUrl+"/payment/check/"+e).pipe((0,t.M)(i=>i),(0,f.W)(i=>(0,M.$)(i)))}chekStatus(e,r,o){const i=(l,d)=>{o.status=l,d&&(o.statusMsg=d),this.firestore.addObjectToMap(`invoices/${r}`,o.eventId,o.id,o).then(()=>{d?this.toastService.error(d,"danger",{timeOut:1e4}):"Completed"===l&&this.toastService.success(e,"success")})};switch(e.data.state){case"financial_transaction_pending":o.status="Pending",setTimeout(()=>{},3e3);break;case"financial_transaction_success":i("Completed");break;case"financial_transaction_error":i("Rejected",{"-201":"Compte Orage Money introuvable","-202":"Receiver account not found","-200":"Erreur inconnue","-204":"Le solde du compte OM payeur insufisant, veuillez recharger votre compte OM","-205":"M\xe9thode de paiment invalide","-206":"Montant invalide","-207":"Longue attente serveur","-208":"La transaction a \xe9t\xe9 rejet\xe9 par le payeur"}[e.data.error]||"Erreur inconnue");break;default:console.warn("Unexpected transaction state:",e.data.state)}}getTransactionData(e,r,o){return this.firestore.readField(`invoices/${e}`,r).pipe((0,t.M)(i=>{if(!i)throw new Error("Invoice not found");return(i=Object.values(i)).filter(l=>l.id==o)}))}getPaymentGatewayKey(){return this.firestore.readField("systemConfig/config","paymentGatwayAPIKey").pipe((0,h.s)(1))}static{this.\u0275fac=function(r){return new(r||s)(m.KVO(_.Qq),m.KVO(C.B),m.KVO(c.tw))}}static{this.\u0275prov=m.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})()},77927:(D,v,n)=>{n.d(v,{D:()=>m});var t=n(48455),f=n(96697),h=n(54438),g=n(78931),a=n(20543),M=n(54441);let m=(()=>{class _{constructor(c,p,s){this.firestore=c,this.storage=p,this.authService=s}getUserData(c){return this.firestore.read(`users/${c}`)}getCurrentUserData(){let c=this.storage.getStorage("user_id");return c?this.firestore.read(`users/${c}`):(0,t.H)(this.authService.logout())}getAllUserData(){return this.firestore.getDocuments("users").pipe((0,f.s)(1))}createUser(c){this.firestore.create(`users/${c.id}`,c).then(()=>({success:!0,message:"Votre compte a bien \xe9t\xe9 cr\xe9\xe9"}))}static{this.\u0275fac=function(p){return new(p||_)(h.KVO(g.B),h.KVO(a.n),h.KVO(M.u))}}static{this.\u0275prov=h.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},12887:(D,v,n)=>{n.r(v),n.d(v,{DataTablesModule:()=>e});var t=n(60177),f=n(51188),h=n(76208),g=n(9159),a=n(54438),M=n(45821),m=n(2042),_=n(14860);function C(r,o){if(1&r&&(a.j41(0,"tr")(1,"td"),a.EFF(2),a.k0s(),a.j41(3,"td"),a.EFF(4),a.k0s(),a.j41(5,"td"),a.EFF(6),a.k0s(),a.j41(7,"td"),a.EFF(8),a.k0s(),a.j41(9,"td"),a.EFF(10),a.k0s(),a.j41(11,"td"),a.EFF(12),a.k0s()()),2&r){const i=o.$implicit;a.R7$(2),a.JRh(i.name),a.R7$(2),a.JRh(i.position),a.R7$(2),a.JRh(i.office),a.R7$(2),a.JRh(i.age),a.R7$(2),a.JRh(i.startDate),a.R7$(2),a.JRh(i.salary)}}const p=[{path:"",component:(()=>{class r{constructor(i,l,d){this.data=i,this.pagination=l,this.router=d,this.routes=h.JZ,this.tableData=[],this.pageSize=10,this.serialNumberArray=[],this.totalData=0,this.showFilter=!1,this.searchDataValue="",this.pagination.tablePageSize.subscribe(E=>{this.router.url==this.routes.dataTables&&(this.getTableData({skip:E.skip,limit:E.limit}),this.pageSize=E.pageSize)})}getTableData(i){this.data.getDataTables().subscribe(l=>{this.tableData=[],this.serialNumberArray=[],this.totalData=l.totalData,l.data.map((d,E)=>{const P=E+1;E>=i.skip&&P<=i.limit&&(d.id=P,this.tableData.push(d),this.serialNumberArray.push(P))}),this.dataSource=new g.I6(this.tableData),this.pagination.calculatePageSize.next({totalData:this.totalData,pageSize:this.pageSize,tableData:this.tableData,tableData2:[],serialNumberArray:this.serialNumberArray})})}sortData(i){const l=this.tableData.slice();this.tableData=i.active&&""!==i.direction?l.sort((d,E)=>(d[i.active]<E[i.active]?-1:1)*("asc"===i.direction?1:-1)):l}static{this.\u0275fac=function(l){return new(l||r)(a.rXU(h.uS),a.rXU(M.mc),a.rXU(f.Ix))}}static{this.\u0275cmp=a.VBU({type:r,selectors:[["app-data-tables"]],decls:37,vars:0,consts:[[1,"page-header"],[1,"content-page-header"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-header","card-buttons"],[1,"card-title"],[1,"card-text"],[1,"card-body"],[1,"table-responsive"],[1,"table-scroll"],["matSort","",1,"datatable","table","table-stripped",3,"matSortChange"],["mat-sort-header","name"],["mat-sort-header","position"],["mat-sort-header","office"],["mat-sort-header","age"],["mat-sort-header","startDate"],["mat-sort-header","salary"]],template:function(l,d){1&l&&(a.j41(0,"div",0)(1,"div",1)(2,"h5"),a.EFF(3,"Default Datatable"),a.k0s()()(),a.j41(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"h4",6),a.EFF(9,"Default Datatable"),a.k0s(),a.j41(10,"p",7),a.EFF(11," This is the most basic example of the datatables with zero configuration. Use the "),a.j41(12,"code"),a.EFF(13,".datatable"),a.k0s(),a.EFF(14," class to initialize datatables. "),a.k0s()(),a.j41(15,"div",8)(16,"div",9)(17,"div",10)(18,"table",11),a.bIt("matSortChange",function(P){return d.sortData(P)}),a.j41(19,"thead")(20,"tr")(21,"th",12),a.EFF(22,"Name"),a.k0s(),a.j41(23,"th",13),a.EFF(24,"Position"),a.k0s(),a.j41(25,"th",14),a.EFF(26,"Office"),a.k0s(),a.j41(27,"th",15),a.EFF(28,"Age"),a.k0s(),a.j41(29,"th",16),a.EFF(30,"Start date"),a.k0s(),a.j41(31,"th",17),a.EFF(32,"Salary"),a.k0s()()(),a.j41(33,"tbody"),a.Z7z(34,C,13,6,"tr",null,a.fX1),a.k0s()()()(),a.nrm(36,"app-custom-pagination"),a.k0s()()()()),2&l&&(a.R7$(34),a.Dyx(d.tableData))},dependencies:[m.B4,m.aE,_.B]})}}return r})()}];let s=(()=>{class r{static{this.\u0275fac=function(l){return new(l||r)}}static{this.\u0275mod=a.$C({type:r})}static{this.\u0275inj=a.G2t({imports:[f.iI.forChild(p),f.iI]})}}return r})();var u=n(76112);let e=(()=>{class r{static{this.\u0275fac=function(l){return new(l||r)}}static{this.\u0275mod=a.$C({type:r})}static{this.\u0275inj=a.G2t({imports:[t.MD,s,u.G]})}}return r})()},14860:(D,v,n)=>{n.d(v,{B:()=>C});var t=n(54438),f=n(96414),h=n(60177),g=n(89417);const a=c=>({disabled:c});function M(c,p){if(1&c){const s=t.RV6();t.j41(0,"li",17),t.bIt("click",function(){t.eBV(s);const e=t.XpG(2);return t.Njj(e.moveToPage(e.currentPage-2))})("keydown.enter",function(){t.eBV(s);const e=t.XpG(2);return t.Njj(e.moveToPage(e.currentPage-2))}),t.j41(1,"a",18),t.EFF(2," ... "),t.k0s()()}if(2&c){const s=t.XpG(2);t.Y8G("hidden",1===s.currentPage)}}function m(c,p){if(1&c){const s=t.RV6();t.j41(0,"li",17),t.bIt("click",function(){t.eBV(s);const e=t.XpG(2);return t.Njj(e.moveToPage(e.currentPage+2))})("keydown.enter",function(){t.eBV(s);const e=t.XpG(2);return t.Njj(e.moveToPage(e.currentPage+2))}),t.j41(1,"a",18),t.EFF(2," ... "),t.k0s()()}if(2&c){const s=t.XpG(2);t.Y8G("hidden",s.currentPage>=s.pageNumberArray[s.pageNumberArray.length-2]||s.totalData<s.serialNumberArray[s.serialNumberArray.length-1])}}function _(c,p){if(1&c){const s=t.RV6();t.j41(0,"li",15)(1,"a",13),t.bIt("click",function(){const e=t.eBV(s).$implicit,r=t.XpG();return t.Njj(r.moveToPage(e))}),t.EFF(2),t.k0s()(),t.DNE(3,M,3,1,"li",16)(4,m,3,1,"li",16)}if(2&c){const s=p.$implicit,u=p.$index,e=t.XpG();t.AVh("active",s===e.currentPage),t.Y8G("ngClass",e.pageNumberArray[e.currentPage-2]>s&&1!==s&&e.pageNumberArray.length>6||e.pageNumberArray[e.currentPage]<s&&1!==s&&e.pageNumberArray.length>6&&e.pageNumberArray.length!==s?"hide-page-no":"show-page-no"),t.R7$(2),t.SpI(" ",s," "),t.R7$(),t.vxM(0===u&&e.pageNumberArray.length>6&&e.currentPage>2?3:-1),t.R7$(),t.vxM(u===e.pageNumberArray.length-2&&e.pageNumberArray.length>6?4:-1)}}let C=(()=>{class c{constructor(s){this.pagination=s,this.pageSize=10,this.tableData=[],this.lastIndex=0,this.totalData=0,this.skip=0,this.limit=this.pageSize,this.pageIndex=0,this.serialNumberArray=[],this.currentPage=1,this.pageNumberArray=[],this.pageSelection=[],this.totalPages=0,this.tableData=[],this.pagination.calculatePageSize.subscribe(u=>{this.calculateTotalPages(u.totalData,u.pageSize,u.tableData,u.serialNumberArray),this.pageSize=u.pageSize}),this.pagination.changePagesize.subscribe(u=>{this.changePageSize(u.pageSize)})}getMoreData(s){"next"==s?(this.currentPage++,this.pageIndex=this.currentPage-1,this.limit+=this.pageSize,this.skip=this.pageSize*this.pageIndex,this.pagination.tablePageSize.next({skip:this.skip,limit:this.limit,pageSize:this.pageSize})):"previous"==s&&(this.currentPage--,this.pageIndex=this.currentPage-1,this.limit-=this.pageSize,this.skip=this.pageSize*this.pageIndex,this.pagination.tablePageSize.next({skip:this.skip,limit:this.limit,pageSize:this.pageSize}))}moveToPage(s){this.currentPage=s,this.skip=this.pageSelection[s-1].skip,this.limit=this.pageSelection[s-1].limit,s>this.currentPage?this.pageIndex=s-1:s<this.currentPage&&(this.pageIndex=s+1),this.pagination.tablePageSize.next({skip:this.skip,limit:this.limit,pageSize:this.pageSize})}changePageSize(s){this.pageSelection=[],this.limit=s,this.skip=0,this.currentPage=1,this.pagination.tablePageSize.next({skip:this.skip,limit:this.limit,pageSize:this.pageSize})}calculateTotalPages(s,u,e,r){this.tableData=e,this.pageNumberArray=[],this.serialNumberArray=r,this.totalData=s,this.totalPages=s/u,this.totalPages%1!=0&&(this.totalPages=Math.trunc(this.totalPages+1));for(let o=1;o<=this.totalPages;o++){const i=u*o,l=i-u;this.pageNumberArray.push(o),this.pageSelection.push({skip:l,limit:i})}}static{this.\u0275fac=function(u){return new(u||c)(t.rXU(f.m))}}static{this.\u0275cmp=t.VBU({type:c,selectors:[["app-custom-pagination"]],decls:25,vars:7,consts:[[1,"table-footer"],[1,"dataTables_length"],[1,"custom-select","custom-select-sm","form-control","form-control-sm",3,"ngModelChange","ngModel"],["value","10"],["value","25"],["value","50"],["value","100"],[1,"pagination"],[1,"pagination_section"],[1,"paginate_button","page-item","previous",3,"ngClass"],["href","javascript:void(0);","tabindex","-1",1,"page-link",3,"click"],[1,"fa","fa-angle-double-left","me-2"],[1,"paginate_button","page-item","next","disabled",3,"ngClass"],["href","javascript:void(0);",1,"page-link",3,"click"],[1,"fa","fa-angle-double-right","me-2"],[1,"page-item",3,"ngClass"],["tabindex","0",1,"page-item",3,"hidden"],["tabindex","0",1,"page-item",3,"click","keydown.enter","hidden"],["href","javascript:void(0);",1,"page-link"]],template:function(u,e){1&u&&(t.j41(0,"div",0)(1,"div",1)(2,"label")(3,"select",2),t.mxI("ngModelChange",function(o){return t.DH7(e.pageSize,o)||(e.pageSize=o),o}),t.bIt("ngModelChange",function(){return e.changePageSize(e.pageSize)}),t.j41(4,"option",3),t.EFF(5,"10"),t.k0s(),t.j41(6,"option",4),t.EFF(7,"25"),t.k0s(),t.j41(8,"option",5),t.EFF(9,"50"),t.k0s(),t.j41(10,"option",6),t.EFF(11,"100"),t.k0s()()()(),t.j41(12,"div",7)(13,"div",8)(14,"ul",7)(15,"li",9)(16,"a",10),t.bIt("click",function(){return e.getMoreData("previous")}),t.nrm(17,"i",11),t.EFF(18,"Previous"),t.k0s()(),t.Z7z(19,_,5,6,null,null,t.fX1),t.j41(21,"li",12)(22,"a",13),t.bIt("click",function(){return e.getMoreData("next")}),t.EFF(23,"Next"),t.nrm(24,"i",14),t.k0s()()()()()()),2&u&&(t.R7$(3),t.R50("ngModel",e.pageSize),t.R7$(12),t.Y8G("ngClass",t.eq3(3,a,1===e.currentPage)),t.R7$(4),t.Dyx(e.pageNumberArray),t.R7$(2),t.Y8G("ngClass",t.eq3(5,a,e.currentPage===e.pageNumberArray[e.pageNumberArray.length-1]||0===e.tableData.length)))},dependencies:[h.YU,g.xH,g.y7,g.wz,g.BC,g.vS]})}}return c})()}}]);